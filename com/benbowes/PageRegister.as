package com.benbowes{	import flash.net.*;	import flash.display.*;	import flash.events.*;	import flash.text.*;	import com.greensock.*;	import com.benbowes.Global;	import com.greensock.easing.*;   		// Import the necessary classes.	import com.jumpeye.Events.FLASHEFFEvents;	import com.jumpeye.flashEff2.text.scrollSlide.FETScrollSlide;	public class PageRegister extends MovieClip {		private var SCOPE:Object = this;		private var required:Array = []		private var fields:Array = [];		private var dropDowns:Array = [];		private var emptyRequiredField:Number = 0;		private var loader:URLLoader = new URLLoader();		private var req:URLRequest = new URLRequest(Global.FLASHVARS.baseUrl + "submit.php");		private var variables:URLVariables = new URLVariables();				private var effect:FlashEff2Code;		private var effect2:FlashEff2Code;		private var showEffect:FETScrollSlide;		private var hideEffect:FETScrollSlide;		private var myTimeline:TimelineMax;		public function PageRegister ():void {			SCOPE.addEventListener (Event.ADDED_TO_STAGE,init,false,0,true);			SCOPE.addEventListener (Event.REMOVED_FROM_STAGE,kill,false,0,true);		}				///////////////////////////////////////////////////////////////////		private function init (e:Event=null):void {   						 myTimeline = new TimelineMax();			 TweenMax.to(masker,1, {height:0}); 			 myTimeline.insert( TweenMax.to(masker,1, {height:356, delay:0.5, ease:Quint.easeInOut}) );  									SCOPE.removeEventListener (Event.ADDED_TO_STAGE,init);			loader.dataFormat = URLLoaderDataFormat.VARIABLES;			req.method = URLRequestMethod.POST;			SCOPE.form.comments.text = "";			SCOPE.form.errorText.alpha = 0;			stage.focus = SCOPE.form.firstName;			stage.stageFocusRect = false; // kill ugly yellow focus outline									required = [SCOPE.form.firstName, 						SCOPE.form.lastName, 						SCOPE.form.email, 						SCOPE.form.phone, 						SCOPE.form.suburb];						fields = [SCOPE.form.firstName, 					  SCOPE.form.lastName, 					  SCOPE.form.email, 					  SCOPE.form.phone, 					  SCOPE.form.address, 					  SCOPE.form.suburb, 					  SCOPE.form.postcode, 					  SCOPE.form.state, 					  SCOPE.form.comments];						dropDowns = [SCOPE.form.lookingFor, 					  SCOPE.form.apartmentType, 					  SCOPE.form.priceRange, 					  SCOPE.form.heardAboutUs]						SCOPE.form.lookingFor.setItems(["Personal residence","Investment"]);			SCOPE.form.apartmentType.setItems(["One Bedroom","Two Bedroom"]);			SCOPE.form.priceRange.setItems(["$300,000-$350,000","$350,000-$400,000","$400,000-$450,000","$450,000-$500,000","$500,000-$600,000","$600,000-$700,000"]);			SCOPE.form.heardAboutUs.setItems(["Email Notice","Onsite Signage","Realestate.com.au","Domain.com.au","The Age","Herald Sun","Chinese Property Weekly","Referral"]);			for(var i=0; i<fields.length; i++){				fields[i].tabIndex = i;			}						SCOPE.form.submitBtn.buttonMode = true;			SCOPE.form.submitBtn.addEventListener (MouseEvent.CLICK, validateForm, false, 0, true);			SCOPE.form.submitBtn.addEventListener (MouseEvent.MOUSE_OVER, handleOver, false, 0, true);			SCOPE.form.submitBtn.addEventListener (MouseEvent.MOUSE_OUT, handleOut, false, 0, true);						SCOPE.form.privacyBtn.addEventListener (MouseEvent.CLICK, privacyLink, false, 0, true);		}		private function privacyLink (e:MouseEvent = null):void {			navigateToURL(new URLRequest("http://www.colliers.com.au/System/Terms-and-conditions.aspx"),"_blank");		}		private function handleOver (e:MouseEvent = null):void {			e.target.alpha = 0.6;		}		private function handleOut (e:MouseEvent = null):void {			e.target.alpha = 1;		}		private function validateForm (e:MouseEvent = null):void {						emptyRequiredField = 0;						SCOPE.form.errorText.alpha = 1;			SCOPE.form.errorText.htmlText = "<font color='#666666'>Checking</font>";						for(var i=0;i<required.length;i++){				if(required[i].text==""){					emptyRequiredField++;				}			}						if(emptyRequiredField>0){				SCOPE.form.errorText.htmlText = "<font color='#ff0000'>Please fill in all fields correctly</font>";			//}else if(SCOPE.form.email.text.indexOf("@") == -1 || SCOPE.form.email.text.indexOf(".") == -1){				//SCOPE.form.errorText.htmlText = "<font color='#ff0000'>Please enter a correct email address</font>";			}else{				SCOPE.form.errorText.htmlText = "<font color='#666666'>SENDING...</font>";				sendForm ();			}		}		private function sendForm ():void {						for(var i=0;i<fields.length;i++){				variables[fields[i].name] = fields[i].text;			}			for(i=0;i<dropDowns.length;i++){				variables[dropDowns[i].name] = dropDowns[i].getValue();			}        						variables["origin"] = "fl";						req.data = variables;						//trace("variables: " + variables);						loader.load (req);			loader.addEventListener (Event.COMPLETE, onSendComplete, false, 0, true);		}		private function onSendComplete (e:Event):void {			TweenMax.killChildTweensOf(SCOPE.form);			loader.removeEventListener (Event.COMPLETE, onSendComplete);			if (e.target.data.returnValue == 1) {				showThankYouFrame();				//TweenMax.to(SCOPE.form,0.5,{alpha:0, ease:Quint.easeInOut, onComplete:showThankYouFrame});			}		}				private function showThankYouFrame(){			var X = form.x			var Y = form.y			var thankYo = SCOPE.addChild(new thankYouFrame());			thankYo.x = X;			thankYo.y = Y;			SCOPE.removeChild(form);			SCOPE.addChild(thankYo);			TweenMax.to(SCOPE.form,0.5,{alpha:1, ease:Quint.easeInOut, delay:0.5});		}				public function hide(){			hideEffect = new FETScrollSlide();			hideEffect.groupDuration = 0.3;			effect.hideTransition = hideEffect;			effect.hide();						myTimeline.timeScale = 3;			myTimeline.reverse();		}				/////////////////////////////////////////////////////////////////		private function kill (e:Event=null) {						TweenMax.killChildTweensOf(MovieClip(SCOPE));			TweenMax.killTweensOf(MovieClip(SCOPE));						SCOPE.form.submitBtn.removeEventListener (MouseEvent.CLICK, validateForm);			SCOPE.form.submitBtn.removeEventListener (MouseEvent.MOUSE_OVER, handleOver);			SCOPE.form.submitBtn.removeEventListener (MouseEvent.MOUSE_OUT, handleOut);			SCOPE.form.privacyBtn.removeEventListener (MouseEvent.CLICK, privacyLink);						SCOPE.removeEventListener (Event.REMOVED_FROM_STAGE,kill);			SCOPE = null;		}	}}